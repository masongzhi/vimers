var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};function clearTimer(t){return t?clearInterval:clearTimeout}function setTimer(t){return t?setInterval:setTimeout}function generateTimer(t){return setTimer(t.repeat)(function(){t.vm.$emit("timer-tick:"+t.name),t.callback()},t.time)}var Timer=function(){function t(e,i){if(classCallCheck(this,t),"production"!==process.env.NODE_ENV){if(!e.name)throw new Error("[vimers.create] name is required");if(!e.callback&&"function"!=typeof i[e.name])throw new ReferenceError("[vimers.create] Cannot find method "+e.name);if(e.callback&&"function"!=typeof e.callback)throw new TypeError("[vimers.create] Timer callback should be a function, "+_typeof(e.callback)+" given")}this.name=e.name,this.time=e.time||0,this.repeat="repeat"in e&&e.repeat,this.immediate="immediate"in e&&e.immediate,this.callback=e.callback&&e.callback.bind(i)||i[e.name],this.instance=null,this.isRunning=!1,this.vm=i}return createClass(t,[{key:"start",value:function(){this.isRunning||(this.isRunning=!0,this.instance=generateTimer(this),this.immediate&&(this.vm.$emit("timer-tick:"+this.name),this.callback()),this.vm.$emit("timer-start:"+this.name))}},{key:"stop",value:function(){this.isRunning&&(clearTimer(this.repeat)(this.instance),this.isRunning=!1,this.vm.$emit("timer-stop:"+this.name))}},{key:"restart",value:function(){this.stop(),this.start(),this.vm.$emit("timer-restart:"+this.name)}}]),t}(),isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function generateOptions(t){return isArray(t)?t.reduce(function(t,e){return t[e.name]=e,t},{}):t}function generateData(t,e){return Object.keys(t).reduce(function(i,n){return i[n]=new Timer(_extends({},t[n],{name:n}),e),i},{})}var METHODS=["start","stop","restart"],Vimers={data:function(){return this.$options.timers?(this.$options.timers=generateOptions(this.$options.timers),{timers:generateData(this.$options.timers,this)}):{}},created:function(){var t=this;this.$options.timers&&(this.$timer=METHODS.reduce(function(e,i){return e[i]=function(e){if("production"!==process.env.NODE_ENV&&!(e in t.$options.timers))throw new ReferenceError("[vimers."+i+"] Cannot find timer "+e);t.timers[e][i]()},e},{}))},mounted:function(){var t=this;if(this.$options.timers){var e=this.$options.timers;Object.keys(e).forEach(function(i){e[i].autostart&&t.$timer.start(i)})}},activated:function(){var t=this;if(this.$options.timers){var e=this.timers,i=this.$options.timers;Object.keys(i).forEach(function(n){i[n].isSwitchTab&&e[n].instance&&t.$timer.start(n)})}},deactivated:function(){var t=this;if(this.$options.timers){var e=this.timers,i=this.$options.timers;Object.keys(i).forEach(function(n){i[n].isSwitchTab&&e[n].instance&&t.$timer.stop(n)})}},beforeDestroy:function(){var t=this;this.$options.timers&&Object.keys(this.$options.timers).forEach(function(e){t.$timer.stop(e)})}};function index(t){t.mixin(Vimers)}var mixin=Vimers;export default index;export{mixin};
